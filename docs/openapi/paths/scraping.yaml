# Scraping Management Endpoints

# Get all scraped URLs with filtering and pagination
/scraping/urls:
  get:
    tags:
      - Scraping
    summary: Get Scraped URLs
    description: Get list of scraped URLs with filters and pagination (admin only)
    security:
      - BearerAuth: []
    parameters:
      - name: status
        in: query
        required: false
        schema:
          type: string
          enum: [pending, in_progress, completed, failed, skipped, partial]
        description: Filter by status
      - name: category
        in: query
        required: false
        schema:
          type: string
        description: Filter by category
      - name: level
        in: query
        required: false
        schema:
          type: string
        description: Filter by difficulty level
      - name: page
        in: query
        required: false
        schema:
          type: integer
          default: 1
          minimum: 1
        description: Page number
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          default: 20
          minimum: 1
          maximum: 100
        description: Items per page
      - name: search
        in: query
        required: false
        schema:
          type: string
        description: Search in URL or title
    responses:
      '200':
        description: Scraped URLs retrieved successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  type: object
                  properties:
                    urls:
                      type: array
                      items:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          url:
                            type: string
                            format: uri
                          status:
                            type: string
                            enum: [pending, in_progress, completed, failed, skipped, partial]
                          title:
                            type: string
                            nullable: true
                          description:
                            type: string
                            nullable: true
                          category:
                            type: string
                            nullable: true
                          level:
                            type: string
                            nullable: true
                          metadata:
                            type: object
                            nullable: true
                          error_message:
                            type: string
                            nullable: true
                          retry_count:
                            type: integer
                            default: 0
                          last_attempt_at:
                            type: string
                            format: date-time
                            nullable: true
                          completed_at:
                            type: string
                            format: date-time
                            nullable: true
                          created_at:
                            type: string
                            format: date-time
                          updated_at:
                            type: string
                            format: date-time
                    pagination:
                      type: object
                      properties:
                        page:
                          type: integer
                        limit:
                          type: integer
                        total:
                          type: integer
                        pages:
                          type: integer
      '401':
        $ref: '../responses/Unauthorized.yaml'
      '403':
        $ref: '../responses/Forbidden.yaml'
      '500':
        description: Internal server error
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: false
                error:
                  type: object
                  properties:
                    message:
                      type: string
                      example: "Failed to fetch scraped URLs"
                    details:
                      type: string

  post:
    tags:
      - Scraping
    summary: Add URL to Scraping Queue
    description: Add a single URL to the scraping queue (admin only)
    security:
      - BearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - url
            properties:
              url:
                type: string
                format: uri
                description: URL to scrape
              title:
                type: string
                description: Optional title for the URL
              description:
                type: string
                description: Optional description
              category:
                type: string
                description: Optional category
              level:
                type: string
                description: Optional difficulty level
              metadata:
                type: object
                description: Additional metadata
    responses:
      '201':
        description: URL added to scraping queue successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  type: object
                  properties:
                    id:
                      type: string
                      format: uuid
                    url:
                      type: string
                      format: uri
                    status:
                      type: string
                      default: pending
                    title:
                      type: string
                      nullable: true
                    description:
                      type: string
                      nullable: true
                    category:
                      type: string
                      nullable: true
                    level:
                      type: string
                      nullable: true
                    metadata:
                      type: object
                      nullable: true
                    created_at:
                      type: string
                      format: date-time
                    updated_at:
                      type: string
                      format: date-time
      '400':
        $ref: '../responses/BadRequest.yaml'
      '401':
        $ref: '../responses/Unauthorized.yaml'
      '403':
        $ref: '../responses/Forbidden.yaml'
      '409':
        description: URL already exists
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: false
                error:
                  type: object
                  properties:
                    message:
                      type: string
                      example: "URL already exists in scraping queue"
                    data:
                      type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                        status:
                          type: string
      '500':
        description: Internal server error
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: false
                error:
                  type: object
                  properties:
                    message:
                      type: string
                      example: "Failed to add URL to scraping queue"
                    details:
                      type: string

# Add multiple URLs to be scraped
/scraping/urls/bulk:
  post:
    tags:
      - Scraping
    summary: Add Multiple URLs to Scraping Queue
    description: Add multiple URLs to the scraping queue in bulk (admin only)
    security:
      - BearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - urls
            properties:
              urls:
                type: array
                items:
                  type: object
                  required:
                    - url
                  properties:
                    url:
                      type: string
                      format: uri
                      description: URL to scrape
                    title:
                      type: string
                      description: Optional title for the URL
                    description:
                      type: string
                      description: Optional description
                    category:
                      type: string
                      description: Optional category
                    level:
                      type: string
                      description: Optional difficulty level
                    metadata:
                      type: object
                      description: Additional metadata
                minItems: 1
    responses:
      '201':
        description: URLs added to scraping queue successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  type: object
                  properties:
                    added:
                      type: array
                      items:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          url:
                            type: string
                          status:
                            type: string
                    errors:
                      type: array
                      items:
                        type: object
                        properties:
                          url:
                            type: string
                          error:
                            type: string
                          data:
                            type: object
                            nullable: true
                    summary:
                      type: object
                      properties:
                        total:
                          type: integer
                        added:
                          type: integer
                        errors:
                          type: integer
      '400':
        $ref: '../responses/BadRequest.yaml'
      '401':
        $ref: '../responses/Unauthorized.yaml'
      '403':
        $ref: '../responses/Forbidden.yaml'
      '500':
        description: Internal server error
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: false
                error:
                  type: object
                  properties:
                    message:
                      type: string
                      example: "Failed to add URLs to scraping queue"
                    details:
                      type: string

# Get pending URLs for scraping
/scraping/urls/pending:
  get:
    tags:
      - Scraping
    summary: Get Pending URLs
    description: Get URLs that are pending processing (admin only)
    security:
      - BearerAuth: []
    parameters:
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          default: 10
          minimum: 1
          maximum: 100
        description: Number of URLs to fetch
    responses:
      '200':
        description: Pending URLs retrieved successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  type: array
                  items:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                      url:
                        type: string
                        format: uri
                      status:
                        type: string
                        default: pending
                      title:
                        type: string
                        nullable: true
                      description:
                        type: string
                        nullable: true
                      category:
                        type: string
                        nullable: true
                      level:
                        type: string
                        nullable: true
                      metadata:
                        type: object
                        nullable: true
                      created_at:
                        type: string
                        format: date-time
                      updated_at:
                        type: string
                        format: date-time
      '401':
        $ref: '../responses/Unauthorized.yaml'
      '403':
        $ref: '../responses/Forbidden.yaml'
      '500':
        description: Internal server error
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: false
                error:
                  type: object
                  properties:
                    message:
                      type: string
                      example: "Failed to fetch pending URLs"
                    details:
                      type: string

# Update URL status (for scraping agent)
/scraping/urls/{id}/status:
  put:
    tags:
      - Scraping
    summary: Update URL Status
    description: Update the status and metadata of a scraped URL (admin only)
    security:
      - BearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: URL ID
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - status
            properties:
              status:
                type: string
                enum: [pending, in_progress, completed, failed, skipped, partial]
                description: New status for the URL
              title:
                type: string
                description: Optional title for the URL
              description:
                type: string
                description: Optional description
              category:
                type: string
                description: Optional category
              level:
                type: string
                description: Optional difficulty level
              metadata:
                type: object
                description: Additional metadata
              error_message:
                type: string
                description: Error message if status is failed
    responses:
      '200':
        description: URL status updated successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  type: object
                  properties:
                    id:
                      type: string
                      format: uuid
                    url:
                      type: string
                      format: uri
                    status:
                      type: string
                    title:
                      type: string
                      nullable: true
                    description:
                      type: string
                      nullable: true
                    category:
                      type: string
                      nullable: true
                    level:
                      type: string
                      nullable: true
                    metadata:
                      type: object
                      nullable: true
                    error_message:
                      type: string
                      nullable: true
                    retry_count:
                      type: integer
                    last_attempt_at:
                      type: string
                      format: date-time
                      nullable: true
                    completed_at:
                      type: string
                      format: date-time
                      nullable: true
                    updated_at:
                      type: string
                      format: date-time
      '400':
        $ref: '../responses/BadRequest.yaml'
      '401':
        $ref: '../responses/Unauthorized.yaml'
      '403':
        $ref: '../responses/Forbidden.yaml'
      '404':
        $ref: '../responses/NotFound.yaml'
      '500':
        description: Internal server error
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: false
                error:
                  type: object
                  properties:
                    message:
                      type: string
                      example: "Failed to update URL status"
                    details:
                      type: string

# Delete a scraped URL
/scraping/urls/{id}:
  delete:
    tags:
      - Scraping
    summary: Delete Scraped URL
    description: Delete a scraped URL from the system (admin only)
    security:
      - BearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: URL ID
    responses:
      '200':
        description: Scraped URL deleted successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                message:
                  type: string
                  example: "URL deleted successfully"
      '401':
        $ref: '../responses/Unauthorized.yaml'
      '403':
        $ref: '../responses/Forbidden.yaml'
      '404':
        $ref: '../responses/NotFound.yaml'
      '500':
        description: Internal server error
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: false
                error:
                  type: object
                  properties:
                    message:
                      type: string
                      example: "Failed to delete URL"
                    details:
                      type: string

# Get scraping statistics
/scraping/stats:
  get:
    tags:
      - Scraping
    summary: Get Scraping Statistics
    description: Get comprehensive scraping statistics and recent activity (admin only)
    security:
      - BearerAuth: []
    responses:
      '200':
        description: Scraping statistics retrieved successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  type: object
                  properties:
                    stats:
                      type: object
                      properties:
                        total:
                          type: integer
                        by_status:
                          type: object
                          properties:
                            pending:
                              type: integer
                            in_progress:
                              type: integer
                            completed:
                              type: integer
                            failed:
                              type: integer
                            skipped:
                              type: integer
                            partial:
                              type: integer
                        summary:
                          type: object
                          properties:
                            pending:
                              type: integer
                            in_progress:
                              type: integer
                            completed:
                              type: integer
                            failed:
                              type: integer
                            skipped:
                              type: integer
                            partial:
                              type: integer
                    recent_activity:
                      type: array
                      items:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          url:
                            type: string
                            format: uri
                          status:
                            type: string
                          title:
                            type: string
                            nullable: true
                          description:
                            type: string
                            nullable: true
                          category:
                            type: string
                            nullable: true
                          level:
                            type: string
                            nullable: true
                          updated_at:
                            type: string
                            format: date-time
      '401':
        $ref: '../responses/Unauthorized.yaml'
      '403':
        $ref: '../responses/Forbidden.yaml'
      '500':
        description: Internal server error
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: false
                error:
                  type: object
                  properties:
                    message:
                      type: string
                      example: "Failed to fetch scraping statistics"
                    details:
                      type: string

# Reset failed URLs for retry
/scraping/urls/reset-failed:
  post:
    tags:
      - Scraping
    summary: Reset Failed URLs
    description: Reset all failed URLs back to pending status for retry (admin only)
    security:
      - BearerAuth: []
    responses:
      '200':
        description: Failed URLs reset successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  type: object
                  properties:
                    reset_count:
                      type: integer
                      description: Number of URLs reset
                    message:
                      type: string
                      example: "Reset 5 failed URLs to pending status"
      '401':
        $ref: '../responses/Unauthorized.yaml'
      '403':
        $ref: '../responses/Forbidden.yaml'
      '500':
        description: Internal server error
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: false
                error:
                  type: object
                  properties:
                    message:
                      type: string
                      example: "Failed to reset failed URLs"
                    details:
                      type: string 